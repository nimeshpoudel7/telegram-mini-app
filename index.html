<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Telegram Mini App</title>
    <!-- IMPORTANT: Include Telegram Web App script FIRST -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
        }

        .button {
            background-color: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
        }

        .user-info {
            background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Welcome to My Mini App</h1>
        <div id="user-info" class="user-info"></div>
        <button class="button" onclick="performAction()">Click Me!</button>
        <button class="button" onclick="showRewardedAd()">Watch Ad for Reward</button>
    </div>

    <script>
        // Initialize Telegram Web App
        let tg = window.Telegram.WebApp;

        // Expand the app to full height
        tg.expand();

        // Show user info
        function displayUserInfo() {
            const user = tg.initDataUnsafe.user;
            const userInfoDiv = document.getElementById('user-info');

            if (user) {
                userInfoDiv.innerHTML = `
                    <h3>User Info</h3>
                    <p><strong>Name:</strong> ${user.first_name} ${user.last_name || ''}</p>
                    <p><strong>Username:</strong> @${user.username || 'N/A'}</p>
                    <p><strong>Language:</strong> ${user.language_code}</p>
                `;
            } else {
                userInfoDiv.innerHTML = '<p>User data not available</p>';
            }
        }

        // Main app functionality
        function performAction() {
            // Show haptic feedback
            tg.HapticFeedback.impactOccurred('medium');

            // Show notification
            tg.showAlert('Action performed successfully!');

            // You can send data back to the bot
            // tg.sendData('user_clicked_button');
        }

        // Function to show rewarded ad (integrate with Monetag)
        function showRewardedAd() {
            // This is where you'd integrate Monetag's ad code
            // For now, we'll simulate an ad
            tg.showConfirm('Watch an ad to get rewards?', (confirmed) => {
                if (confirmed) {
                    // Here you would trigger the actual Monetag ad
                    // After ad is watched, give reward
                    tg.showAlert('Thanks for watching! You earned 10 coins.');

                    // Update user's balance in your backend
                    updateUserBalance(10);
                }
            });
        }

        // Function to update user balance (you'd implement this with your backend)
        function updateUserBalance(amount) {
            // Send update to your server
            console.log(`User balance increased by ${amount}`);
        }

        // Initialize app when page loads
        window.addEventListener('load', () => {
            displayUserInfo();

            // Set up main button
            tg.MainButton.setText('Main Action');
            tg.MainButton.show();
            tg.MainButton.onClick(() => {
                performAction();
            });
        });

        // Handle when app is closing
        window.addEventListener('beforeunload', () => {
            tg.close();
        });
    </script>
</body>

</html>